(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function c(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(i){if(i.ep)return;i.ep=!0;const o=c(i);fetch(i.href,o)}})();const D="modulepreload",F=function(e){return"/"+e},x={},A=function(n,c,t){let i=Promise.resolve();if(c&&c.length>0){let s=function(l){return Promise.all(l.map(m=>Promise.resolve(m).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=s(c.map(l=>{if(l=F(l),l in x)return;x[l]=!0;const m=l.endsWith(".css"),u=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=m?"stylesheet":D,m||(d.as="script"),d.crossOrigin="",d.href=l,r&&d.setAttribute("nonce",r),document.head.appendChild(d),m)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&o(a.reason);return n().catch(o)})},_=150,O=.8,C="₹",y=document.getElementById("uploadZone"),B=document.getElementById("fileInput"),$=document.getElementById("artworkList"),M=document.getElementById("totalCost");let U=[];function E(){const e=U.reduce((n,c)=>n+(c.cost??0),0);M.textContent=C+e.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}function S(e,n){const c=parseFloat(e),t=parseFloat(n);return Number.isNaN(c)||Number.isNaN(t)||c<=0||t<=0?0:(c+1)*(t+1)*O}function P(e){return(e/_).toFixed(2)}function q(e){const n=document.createElement("div");n.className="artwork-card",n.dataset.id=e.id;const c=document.createElement("div");c.className="preview-wrap";const t=document.createElement("img");t.src=e.previewUrl,t.alt="Artwork preview",t.onload=()=>{if(!e.widthInches&&!e.heightInches){e.widthInches=P(t.naturalWidth),e.heightInches=P(t.naturalHeight),e.cost=S(e.heightInches,e.widthInches);const f=n.querySelector(".input-w"),p=n.querySelector(".input-h"),v=n.querySelector(".cost-line");f&&(f.value=e.widthInches),p&&(p.value=e.heightInches),v&&(v.textContent=`Cost: ${C}${Number(e.cost).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`),E()}},c.appendChild(t);const i=document.createElement("div");i.className="info";const o=document.createElement("div");o.className="dimensions",o.innerHTML=`
    <label>W <input type="number" class="input-w" step="0.01" min="0.1" placeholder="inches" value="${e.widthInches||""}"></label>
    <label>H <input type="number" class="input-h" step="0.01" min="0.1" placeholder="inches" value="${e.heightInches||""}"></label>
  `;const s=document.createElement("div");s.className="cost-line",s.textContent=e.cost!=null?`Cost: ${C}${Number(e.cost).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`Cost: ${C}0.00`;const a=()=>{const f=n.querySelector(".input-w").value,p=n.querySelector(".input-h").value;e.widthInches=f,e.heightInches=p,e.cost=S(p,f),s.textContent=`Cost: ${C}${Number(e.cost).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,E()};o.querySelector(".input-w").addEventListener("input",a),o.querySelector(".input-h").addEventListener("input",a),i.appendChild(o),i.appendChild(s);const r=document.createElement("div");r.className="actions";const l=document.createElement("button");l.type="button",l.className="btn btn-primary",l.textContent="Remove background";const m=document.createElement("div");m.className="bg-removal-status",m.setAttribute("aria-live","polite"),l.addEventListener("click",()=>H(e,c,t,l,n,m));const u=document.createElement("button");u.type="button",u.className="btn btn-ghost btn-download-png",u.textContent="Download PNG",u.style.display=e.backgroundRemoved?"":"none",u.addEventListener("click",()=>T(e));const d=document.createElement("button");return d.type="button",d.className="btn btn-danger",d.textContent="Remove artwork",d.addEventListener("click",()=>{const f=U.findIndex(p=>p.id===e.id);f!==-1&&(U.splice(f,1),n.remove(),E())}),r.appendChild(l),r.appendChild(m),r.appendChild(u),r.appendChild(d),n.appendChild(c),n.appendChild(i),n.appendChild(r),n}function T(e){if(!e.backgroundRemoved||!e.previewUrl)return;const c=(e.file&&e.file.name?e.file.name.replace(/\.[^.]+$/,""):"image")+"_nobg.png",t=document.createElement("a");t.href=e.previewUrl,t.download=c,t.rel="noopener",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function h(e,n,c=!0){e&&(e.textContent=n,e.classList.toggle("active",c))}function j(e,n,c){const t=e.data,i=new Uint8ClampedArray(t.length);i.set(t);const o=1;for(let s=o;s<c-o;s++)for(let a=o;a<n-o;a++){let r=0,l=255;for(let d=-o;d<=o;d++)for(let f=-o;f<=o;f++){const p=((s+d)*n+(a+f))*4+3;r=Math.max(r,t[p]),l=Math.min(l,t[p])}const m=(s*n+a)*4+3,u=t[m];u<128?i[m]=Math.min(u,l+40):i[m]=Math.max(u,r-40)}for(let s=0;s<t.length;s++)t[s]=i[s]}function W(e,n,c,t=2){const i=e.data,o=new Float32Array(n*c);for(let r=0;r<n*c;r++)o[r]=i[r*4+3];const s=new Float32Array(n*c),a=(2*t+1)**2;for(let r=t;r<c-t;r++)for(let l=t;l<n-t;l++){let m=0;for(let u=-t;u<=t;u++)for(let d=-t;d<=t;d++)m+=o[(r+u)*n+(l+d)];s[r*n+l]=m/a}for(let r=0;r<n*c;r++)i[r*4+3]=Math.round(s[r])}async function H(e,n,c,t,i,o){t.disabled=!0,o&&h(o,""),n.classList.add("loading");try{h(o,"Loading…",!0);const s=(await A(async()=>{const{default:g}=await import("./index-CMMp6uBd.js");return{default:g}},[])).default,a=new Image;a.crossOrigin="anonymous",a.src=e.previewUrl,await new Promise((g,I)=>{a.onload=g,a.onerror=I});const r=a.naturalWidth,l=a.naturalHeight,m=e.file||await(async()=>await(await fetch(e.previewUrl)).blob())(),u={output:{format:"image/png",type:"foreground"},progress:(g,I,N)=>{g.startsWith("fetch")&&N>0&&o&&h(o,`Downloading model… ${Math.round(I/N*100)}%`,!0)}};h(o,"SAM segmentation…",!0);const d=await s(m,u),f=URL.createObjectURL(d),p=new Image;p.crossOrigin="anonymous",p.src=f,await new Promise((g,I)=>{p.onload=g,p.onerror=I});const v=document.createElement("canvas");v.width=r,v.height=l;const b=v.getContext("2d");b.drawImage(p,0,0,r,l),URL.revokeObjectURL(f);let L=b.getImageData(0,0,r,l);h(o,"Refine mask…",!0),j(L,r,l),b.putImageData(L,0,0),h(o,"Alpha matte smoothing…",!0),L=b.getImageData(0,0,r,l),W(L,r,l,2),b.putImageData(L,0,0),h(o,"Export ready",!1);const w=v.toDataURL("image/png");if(e.originalPreviewUrl&&URL.revokeObjectURL(e.previewUrl),e.originalPreviewUrl=e.originalPreviewUrl||e.previewUrl,e.previewUrl=w,e.backgroundRemoved=!0,c.src=w,i){i.classList.add("background-removed");const g=i.querySelector(".btn-download-png");g&&(g.style.display="")}}catch(s){h(o,"",!1);const a=(s==null?void 0:s.message)||String(s),r=a.includes("fetch")||a.includes("Failed to fetch")?" First run downloads the model (~40MB). Use npm run dev and check your network.":"";console.error("Background removal error:",s),alert("Background removal failed: "+a+r)}finally{n.classList.remove("loading"),t.disabled=!1}}function Z(e){const n="a"+Date.now()+"_"+Math.random().toString(36).slice(2),c=URL.createObjectURL(e),t={id:n,file:e,previewUrl:c,widthInches:null,heightInches:null,cost:0,backgroundRemoved:!1};U.push(t);const i=q(t);$.appendChild(i),E()}function R(e){Array.from(e).filter(c=>c.type.startsWith("image/")).forEach(Z)}B.addEventListener("change",e=>{R(e.target.files),e.target.value=""});y.addEventListener("dragover",e=>{e.preventDefault(),y.classList.add("dragover")});y.addEventListener("dragleave",()=>y.classList.remove("dragover"));y.addEventListener("drop",e=>{e.preventDefault(),y.classList.remove("dragover"),R(e.dataTransfer.files)});export{A as _};
